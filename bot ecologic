import discord
import random

# Inicializa las intenciones de mensajes y eventos del servidor
intents = discord.Intents.default()
intents.message_content = True
client = discord.Client(intents=intents)

# Variables para los puntos y las actividades del bot
puntos_usuarios = {}
desafios = [
    "Evita el plÃ¡stico desechable durante 24 horas ğŸŒ",
    "Usa transporte pÃºblico o camina en lugar de conducir ğŸš¶â€â™‚ï¸",
    "Ahorra agua hoy al reducir el tiempo de ducha ğŸš¿",
]

trivia_preguntas = {
    "Â¿CuÃ¡l es la fuente de energÃ­a renovable mÃ¡s usada en el mundo?": "hidroelÃ©ctrica",
    "Â¿CuÃ¡ntos aÃ±os tarda en degradarse una botella de plÃ¡stico?": "450 aÃ±os",
    "Â¿CuÃ¡l es el gas de efecto invernadero mÃ¡s abundante?": "diÃ³xido de carbono",
}

# Evento de conexiÃ³n
@client.event
async def on_ready():
    print(f'Â¡EcoBot se conectÃ³ como: {client.user}!')

@client.event
async def on_message(message):
    if message.author == client.user:
        return

    # Comando para enviar un enlace de YouTube
    elif message.content.startswith("!video"):
        await message.channel.send("Mira este video sobre sostenibilidad: https://www.youtube.com/watch?v=xCaI-5WVRlY")

# Evento de bienvenida para nuevos miembros
@client.event
async def on_member_join(member):
    channel = discord.utils.get(member.guild.text_channels, name="general")
    if channel:
        await channel.send(f"Â¡Bienvenido/a {member.mention}! ğŸŒ± EcoBot te invita a cuidar el planeta con nosotros.")

# Evento de mensaje para procesar comandos
@client.event
async def on_message(message):
    if message.author == client.user:
        return

    # Comando de saludo
    elif message.content.startswith('hola'):
        await message.channel.send("Â¡Hola eco-amigo! ğŸŒ")

    # Comando de despedida
    elif message.content.startswith('chau'):
        await message.channel.send("Â¡Nos vemos! Cuida el planeta ğŸŒ±")

    # Comando de desafÃ­o diario
    elif message.content.startswith("desafio"):
        desafio = random.choice(desafios)
        user = message.author.name
        await message.channel.send(f"ğŸŒ DesafÃ­o para {user}: {desafio}")
        puntos_usuarios[user] = puntos_usuarios.get(user, 0) + 10
        await message.channel.send(f"Â¡Ganaste 10 puntos! Ahora tienes {puntos_usuarios[user]} puntos.")

    # Comando de trivia ambiental
    elif message.content.startswith("trivia"):
        pregunta, respuesta = random.choice(list(trivia_preguntas.items()))
        await message.channel.send(f"ğŸ§  Trivia: {pregunta}")

        def check(m):
            return m.author == message.author and m.channel == message.channel

        try:
            msg = await client.wait_for('message', check=check, timeout=15.0)
        except:
            await message.channel.send("â° Â¡Tiempo agotado!")
            return

        if msg.content.lower() == respuesta.lower():
            await message.channel.send("âœ… Â¡Correcto! Ganaste 5 puntos.")
            puntos_usuarios[msg.author.name] = puntos_usuarios.get(msg.author.name, 0) + 5
        else:
            await message.channel.send(f"âŒ Incorrecto. La respuesta era: {respuesta}")
        
        await message.channel.send(f"Tienes {puntos_usuarios[msg.author.name]} puntos.")

    # Comando para consultar puntos
    elif message.content.startswith("puntos"):
        user = message.author.name
        puntos = puntos_usuarios.get(user, 0)
        await message.channel.send(f"ğŸŒŸ {user}, tienes {puntos} puntos de sostenibilidad.")

client.run("token")
